# 데이터 처리 워크플로우

## 📁 파일 구조

```
public/data/
├── raw/                          # 원본 파일 (컨텐츠팀 제공)
│   ├── 정법생윤.csv
│   ├── 경제.csv
│   └── 문제데이터_2025-10-03.csv  # DB 데이터
└── modified/                     # 처리된 파일
    ├── 정법.csv
    ├── 생윤.csv
    ├── 정법생윤경제.csv
    ├── 정법생윤경제-refined.csv
    ├── 정법생윤경제-verification.csv
    └── 검증상태보고서.csv
```

## 🔄 처리 단계

### 1단계: 과목별 분리
**스크립트**: `scripts/separate-subjects.js`

```
정법생윤.csv (414행)
    ↓ 과목 컬럼(기존 사탐 범주) 기준 분리
    ├─→ 정법.csv (299행, 순번 1-298)
    └─→ 생윤.csv (115행, 순번 1-115)
```

**처리 내용**:
- 중복된 빈 헤더 처리 (`__INDEX__`, `__EMPTY_*`)
- 생윤: 마지막 컬럼 값을 첫 번째 컬럼(순번)으로 이동
- 정법: 기존 첫 번째 컬럼을 순번으로 사용

### 2단계: 전체 병합
**스크립트**: `scripts/merge-all-subjects.js`

```
정법.csv (299행) ─┐
생윤.csv (115행) ─┼─→ 정법생윤경제.csv (1,012행)
경제.csv (598행) ─┘
```

**처리 내용**:
- 모든 과목의 컬럼 합집합 (15개 컬럼)
- 과목별 순번(1-N) 유지
- 누락된 컬럼은 빈 값으로 채움

### 3단계: 정제
**스크립트**: `scripts/refine-merged-csv.js`

```
정법생윤경제.csv (1,012행)
    ↓ 정제
정법생윤경제-refined.csv (998행, 13개 컬럼)
```

**처리 내용**:
- 순번이 숫자가 아닌 행 제거 (14행 제거)
- 전역 인덱스 추가 (`global_index`: 1-998)
- 불필요한 컬럼 제거: 빈 헤더, 비고, 작업 상태값
- 과목별 순번은 그대로 유지

### 4단계: DB 데이터 매칭
**스크립트**: `scripts/create-verification-file.js`

```
정법생윤경제-refined.csv (998행)
    + 문제데이터_2025-10-03.csv (995행)
    ↓ 매칭: 과목 + 순번
정법생윤경제-verification.csv (998행, 24개 컬럼)
```

**매칭 로직**:
- `기존 사탐 범주` = `관련 과목`
- `순번` = `문제 파일명`에서 추출한 번호
- DB 컬럼은 `DB_` 접두사로 추가
- `번호` 컬럼은 제외

**결과**:
- 매칭: 996행 (99.8%)
- 미매칭: 2행 (경제 #118, #478)

### 5단계: 검증 분석
**스크립트**: `scripts/analyze-verification.js`

```
정법생윤경제-verification.csv
    ↓ 분석
검증상태보고서.csv
```

**분석 내용**:
1. **항목 개수**: 전체 및 과목별 통계
2. **순번 무결성**: 중복/누락 검사
3. **DB 미매칭**: 누락된 항목 상세

## 📊 최종 결과

### 전체 통계
- **총 998개 항목**
- **DB 매칭**: 996개 (99.8%)
- **DB 미매칭**: 2개 (0.2%)

### 과목별 상세

| 과목 | 파일 행 수 | DB 매칭 | DB 고유 항목 | 이슈 |
|------|-----------|---------|-------------|------|
| 정치와 법 | 299 | 299 | 298 | 순번 #298 중복 |
| 생활과 윤리 | 115 | 115 | 115 | 없음 ✅ |
| 경제 | 584 | 582 | 582 | 순번 #555, #566 누락<br>DB 미매칭 #118, #478 |

## 🚨 발견된 문제점

### 1. 정치와 법 - 중복 순번
- **문제**: 순번 #298이 2번 나타남
- **영향**: 파일에는 299행이지만 고유 항목은 298개

### 2. 경제 - 누락된 순번
- **문제**: 순번 #555, #566 누락 (범위: 1-586)
- **영향**: 연속되지 않은 순번

### 3. 경제 - DB 미매칭 항목
- **#118**: 2021년 4월 학평 6번 (태그: 정부의 경제적 역할)
- **#478**: 2021년 4월 학평 16번 (태그: 환율 변동의 영향)

## 📝 참고사항

- 모든 스크립트는 `scripts/` 폴더에 위치
- 원본 파일(`raw/`)은 수정하지 않음
- 처리된 파일은 모두 `modified/` 폴더에 저장
- 각 단계는 독립적으로 실행 가능
